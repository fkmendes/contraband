<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.branchratemodel:beast.evolution.likelihood" required="BEAST v2.5.0" version="2.5">

<map name="Uniform" >beast.math.distributions.Uniform</map>
<map name="Exponential" >beast.math.distributions.Exponential</map>
<map name="LogNormal" >beast.math.distributions.LogNormalDistributionModel</map>
<map name="Normal" >beast.math.distributions.Normal</map>
<map name="Beta" >beast.math.distributions.Beta</map>
<map name="Gamma" >beast.math.distributions.Gamma</map>
<map name="LaplaceDistribution" >beast.math.distributions.LaplaceDistribution</map>
<map name="prior" >beast.math.distributions.Prior</map>
<map name="InverseGamma" >beast.math.distributions.InverseGamma</map>
<map name="OneOnX" >beast.math.distributions.OneOnX</map>
<map name="Dirichlet" >beast.math.distributions.Dirichlet</map>

<data id="discrete_traits" dataType="standard">
<sequence id="seq_t28_1" taxon="t28_1" totalcount="3" value="011"/>
                  <sequence id="seq_t19_1" taxon="t19_1" totalcount="3" value="100"/>
                  <sequence id="seq_t26_1" taxon="t26_1" totalcount="3" value="011"/>
                  <sequence id="seq_t14_1" taxon="t14_1" totalcount="3" value="011"/>
                  <sequence id="seq_t10_1" taxon="t10_1" totalcount="3" value="001"/>
                  <sequence id="seq_t15_1" taxon="t15_1" totalcount="3" value="100"/>
                  <sequence id="seq_t7_1" taxon="t7_1" totalcount="3" value="001"/>
                  <sequence id="seq_t24_1" taxon="t24_1" totalcount="3" value="100"/>
                  <sequence id="seq_t3_1" taxon="t3_1" totalcount="3" value="100"/>
                  <sequence id="seq_t17_1" taxon="t17_1" totalcount="3" value="011"/>
                  <sequence id="seq_t18_1" taxon="t18_1" totalcount="3" value="100"/>
                  <sequence id="seq_t23_1" taxon="t23_1" totalcount="3" value="100"/>
                  <sequence id="seq_t6_1" taxon="t6_1" totalcount="3" value="100"/>
                  <sequence id="seq_t30_1" taxon="t30_1" totalcount="3" value="100"/>
                  <sequence id="seq_t21_1" taxon="t21_1" totalcount="3" value="001"/>
                  <sequence id="seq_t27_1" taxon="t27_1" totalcount="3" value="100"/>
                  <sequence id="seq_t11_1" taxon="t11_1" totalcount="3" value="100"/>
                  <sequence id="seq_t2_1" taxon="t2_1" totalcount="3" value="011"/>
                  <sequence id="seq_t13_1" taxon="t13_1" totalcount="3" value="100"/>
                  <sequence id="seq_t16_1" taxon="t16_1" totalcount="3" value="100"/>
                  <sequence id="seq_t8_1" taxon="t8_1" totalcount="3" value="100"/>
                  <sequence id="seq_t4_1" taxon="t4_1" totalcount="3" value="100"/>
                  <sequence id="seq_t1_1" taxon="t1_1" totalcount="3" value="100"/>
                  <sequence id="seq_t29_1" taxon="t29_1" totalcount="3" value="001"/>
                  <sequence id="seq_t9_1" taxon="t9_1" totalcount="3" value="011"/>
                  <sequence id="seq_t20_1" taxon="t20_1" totalcount="3" value="011"/>
                  <sequence id="seq_t45_1" taxon="t45_1" totalcount="3" value="011"/>
</data>

<run id="mcmc" spec="MCMC" chainLength="25000000">
	<state id="state" storeEvery="5000">
		<tree id="TheTree" name="stateNode" spec='beast.util.ZeroBranchSATreeParser'
					newick="((t26_1:6.755241538,((t19_1:4.164932741,((t18_1:2.154301922,(t13_1:1.005227174,t16_1:1.005227174):1.149074748):1.650436169,(t6_1:2.066355068,t30_1:2.066355068):1.738383023):0.360194651):2.041153448,(t14_1:3.946804841,t10_1:3.946804841):2.259281349):0.5491553485):1.395019673,((t21_1:4.037250483,((t7_1:2.697136865,(t23_1:2.141540548,(((t1_1:0.6044039339,t29_1:0.6044039339):0.8623326686,t11_1:1.466736602):0.1986988108,t27_1:1.665435413):0.4761051349):0.555596317):1.06212814,t15_1:3.759265005):0.2779854781):3.287163939,(((t2_1:1.314828136,(t9_1:0.1271266357,t20_1:0.1271266357):1.1877015):2.994071562,((t3_1:2.300419345,t17_1:2.300419345):0.3258238697,t24_1:2.626243214):1.682656483):1.289110297,(t28_1:4.906768868,((t8_1:0.7035362553,t4_1:0.7035362553):3.866227581,t45_1:0):0.3370050318):0.6912411265):1.726404427):0.8258467888):1.937546349;"
					IsLabelledNewick="true">
	            <taxonset id="TaxonSet" spec="TaxonSet">
                <taxon id="t28_1" spec="Taxon"/>
                  <taxon id="t19_1" spec="Taxon"/>
                  <taxon id="t26_1" spec="Taxon"/>
                  <taxon id="t14_1" spec="Taxon"/>
                  <taxon id="t10_1" spec="Taxon"/>
                  <taxon id="t15_1" spec="Taxon"/>
                  <taxon id="t7_1" spec="Taxon"/>
                  <taxon id="t24_1" spec="Taxon"/>
                  <taxon id="t3_1" spec="Taxon"/>
                  <taxon id="t17_1" spec="Taxon"/>
                  <taxon id="t18_1" spec="Taxon"/>
                  <taxon id="t23_1" spec="Taxon"/>
                  <taxon id="t6_1" spec="Taxon"/>
                  <taxon id="t30_1" spec="Taxon"/>
                  <taxon id="t21_1" spec="Taxon"/>
                  <taxon id="t27_1" spec="Taxon"/>
                  <taxon id="t11_1" spec="Taxon"/>
                  <taxon id="t2_1" spec="Taxon"/>
                  <taxon id="t13_1" spec="Taxon"/>
                  <taxon id="t16_1" spec="Taxon"/>
                  <taxon id="t8_1" spec="Taxon"/>
                  <taxon id="t4_1" spec="Taxon"/>
                  <taxon id="t1_1" spec="Taxon"/>
                  <taxon id="t29_1" spec="Taxon"/>
                  <taxon id="t9_1" spec="Taxon"/>
                  <taxon id="t20_1" spec="Taxon"/>
                  <taxon id="t45_1" spec="Taxon"/>
	            </taxonset>
            <trait id="FossilSet" spec="beast.evolution.tree.TraitSet" traitname="date-backward">
                t45_1=4.569763836223
                <taxa idref="TaxonSet"/>
            </trait>
        </tree>
		<stateNode idref="rootValues"/>
        <stateNode idref="inverseMatrix"/>
        <parameter id="FBDdiversificationRate" name="stateNode">0.2368340942141</parameter>
        <parameter id="FBDturnover" name="stateNode">0.206417565341197</parameter>
        <parameter id="FBDsamplingProportion" name="stateNode">0.324999749569728</parameter>
        <parameter id="FBDorigin" name="stateNode">10.0878075598333</parameter>
        <stateNode idref="binaryLiabilities"/>
	</state>

	<distribution id="posterior" spec="util.CompoundDistribution">
    <!-- START prior -->
    <distribution id="prior" spec="util.CompoundDistribution">
        <!-- tree prior -->
        <distribution id="FBD" spec="beast.evolution.speciation.SABirthDeathModel"
                      diversificationRate="@FBDdiversificationRate"
                      turnover="@FBDturnover"
                      samplingProportion="@FBDsamplingProportion"
                      origin="@FBDorigin"
                      tree="@TheTree">
            <parameter id="FBDremovalProb" lower="0.0" name="removalProbability" upper="1.0">0.0</parameter>
            <parameter id="FBDrho" lower="0.0" name="rho" upper="1.0">1.0</parameter>
        </distribution>
        <distribution id="DivRatePrior" spec="beast.math.distributions.Prior" x="@FBDdiversificationRate">
            <distr id="LogNormal.divrate" spec="beast.math.distributions.LogNormalDistributionModel" S="0.1" M="-1.3"/>
        </distribution>

        <distribution id="TurnOverPrior" spec="beast.math.distributions.Prior" x="@FBDturnover">
            <distr id="beta.turnover" spec="beast.math.distributions.Beta" alpha="10" beta="30"/>
        </distribution>

        <distribution id="SamplePropPrior" spec="beast.math.distributions.Prior" x="@FBDsamplingProportion">
            <distr id="beta.sampleprop" spec="beast.math.distributions.Beta" alpha="20" beta="30"/>
        </distribution>

        <distribution id="OriginPrior" spec="beast.math.distributions.Prior" x="@FBDorigin">
            <distr id="LogNormal.origin" spec="beast.math.distributions.LogNormalDistributionModel" S="0.1" M="2.3"/>
        </distribution>

        <!-- BM model prior -->
        <distribution id="wishartPrior" spec="beast.math.distributions.WishartDistribution" df="6.0" arg="@inverseMatrix">
            <scaleMatrix id="scaleMatrix" spec="parameter.RealParameter">
                1.49034572608069 -0.436889963669785 -0.317547149648289 1.22679571548944 -0.21430591686596 -0.943851168797717 -0.436889963669785 0.152843458097388 0.101268008760728 -0.351324514981584 0.0428937022985473 0.277358098692291 -0.317547149648289 0.101268008760728 0.105465561650186 -0.267894088320626 0.0486078319485882 0.186106328195002 1.22679571548944 -0.351324514981584 -0.267894088320626 1.05543960477169 -0.216811995302012 -0.763923866166168 -0.214305916865961 0.0428937022985475 0.0486078319485883 -0.216811995302013 0.147298917705108 0.0595146243399527 -0.943851168797716 0.277358098692291 0.186106328195002 -0.763923866166168 0.0595146243399522 0.709949981843413
            </scaleMatrix>
        </distribution>

        <distribution id="MeanPrior" spec="beast.math.distributions.Prior" x="@rootValues">
	        <distr id="Normal.Mean" spec="beast.math.distributions.Normal" mean="0" sigma="2"/>
        </distribution>
    </distribution>
    <!-- END prior -->

    <!-- START likelihood -->
    <distribution id="likelihood" spec="util.CompoundDistribution" useThreads="false">
     <!-- START Morphological likleihood-->
        <distribution id="BinaryDiscreteLikelihood" spec="contraband.prunelikelihood.BinaryDiscreteTraits" tree="@TheTree">
            <liability id="binaryLiabilities" spec="parameter.RealParameter">1.0</liability>
            <data id="binaryData" spec="FilteredAlignment" data="@discrete_traits" filter="1,2,3"/>
        </distribution>

        <distribution id="LiabilityLikelihood" spec="contraband.prunelikelihood.LiabilityLikelihood">
			<tree idref="TheTree"/>

            <binaryDiscreteTraits idref="BinaryDiscreteLikelihood"/>

            <traits id="oneTraitData" spec="outercore.parameter.KeyRealParameter" minordimension="3" keys="t28_1 t19_1 t26_1 t14_1 t10_1 t15_1 t7_1 t24_1 t3_1 t17_1 t18_1 t23_1 t6_1 t30_1 t21_1 t27_1 t11_1 t2_1 t13_1 t16_1 t8_1 t4_1 t1_1 t29_1 t9_1 t20_1 t45_1">
                -2.78837808446961 -6.81874065593805 4.08034611970403 0.977231356462338 1.84918937123518 -5.83864072065619 -13.5114454410808 -35.127169780003 38.7041032002794 -8.66453104684587 -24.9127970537738 26.7121651556494 -2.70743015860728 -6.15904561921324 4.56716852375613 -0.920066278155688 4.65426297699436 -10.0722066427194 -1.81362513215085 -3.95363703693772 1.11116217947579 2.07461898321321 5.94512751919527 -12.155806156674 0.487685990628866 1.80167121911962 -7.23714750980101 -4.93518780658867 -13.5818534706938 11.3966608305999 4.57336674464231 14.0832773371593 -19.6977471202382 2.81705026703668 9.04037157224335 -14.6292437694898 11.8644002271003 36.0500383341495 -47.7272471279192 6.82860142933419 16.0044347489003 -24.699538751474 -2.05644909208446 -1.28476527448655 -0.773760550292794 4.50645401905457 15.9391584627866 -23.1846703731319 8.32260338136875 26.6106056114065 -36.390848492143 -16.0970708503083 -44.0739448063132 49.7336134239789 3.0533924105738 8.03999080105028 -11.4462896177507 3.2392754095829 10.6844992996102 -15.1306664194916 -0.154326173892786 4.72081941723084 -10.500176487103 0.936609865377656 7.03123229894423 -13.6926888972163 2.51999145715134 8.89666310565212 -14.8162810962401 -2.5389537547652 -4.94440678486808 2.24989635565947 -12.0655170267628 -36.8225159911904 41.5382468605203 -12.3492029496033 -38.5078524557052 43.9546771380441 -5.89525512842933 -15.0889175624614 13.9097431810783
            </traits>

			<branchRateModel id="rateCatClock" spec="contraband.clock.RateCategoryClockModel" nCat="1">
                <rates id="rateValues" spec="parameter.RealParameter">1.0</rates>
                <rateCatAssign id="rateAssignments" spec="parameter.IntegerParameter" lower="0" upper="1">0</rateCatAssign>
                <tree idref="TheTree"/>
            </branchRateModel>

            <nodeMath id="pcmNodeMath" spec="contraband.math.NodeMath" traits="@oneTraitData" oneRateOnly="true">
                <binaryDiscreteTraits idref="BinaryDiscreteLikelihood"/>
            	<sigmasq id="varValues" spec="parameter.RealParameter">1.0</sigmasq>
                <inverseMatrix id="inverseMatrix" spec="parameter.RealParameter">1.0</inverseMatrix>
                <rootValues id="rootValues" spec="parameter.RealParameter">-2.18536015063893 -3.35800476787886 -0.492498875635612 -1.95735752130686 -2.0764547820007 0.108444328482739</rootValues>
            </nodeMath>
        </distribution>
        <!-- END Morphological likleihood -->
	</distribution> 
	<!-- END Likelihood -->
	</distribution> 
	<!-- END Posterior -->

    <operator id="FBDDiveRateScaler" spec="ScaleOperator" parameter="@FBDdiversificationRate" scaleFactor="0.75" weight="2.0"/>
    <operator id="FBDTurnOverScaler" spec="ScaleOperator" parameter="@FBDturnover" scaleFactor="0.75" weight="2.0"/>
    <operator id="FBDSamplingPropScaler" spec="ScaleOperator" parameter="@FBDsamplingProportion" scaleFactor="0.75" weight="2.0"/>
    <operator id="FBDoriginScaler" spec="ScaleOperator" parameter="@FBDorigin" scaleFactor="0.75" weight="2.0"/>

    <operator id="GibbsOperator" spec="contraband.prunelikelihood.InverseMatrixGibbsOperator" dimension="6" inverseMatrix="@inverseMatrix" distr="@wishartPrior" likelihood="@LiabilityLikelihood" nodeMath="@pcmNodeMath" weight="5.0"/>
    <operator id="MeanRandomWalk" spec="RealRandomWalkOperator" parameter="@rootValues" windowSize="1.0" weight="6.0"/>

    <operator id="FBDLeafToSA" spec="LeafToSampledAncestorJump" tree="@TheTree" weight="1.0"/>
    <operator id="FBDSAWilsonBalding" spec="SAWilsonBalding" tree="@TheTree" weight="3.0"/>
    <operator id="FBDSAWide" spec="SAExchange" isNarrow="false" tree="@TheTree" weight="3.0"/>
    <operator id="FBDSANarrow" spec="SAExchange" tree="@TheTree" weight="10.0"/>
    <operator id="FBDSAUniformOperator" spec="SAUniform" tree="@TheTree" weight="20.0"/>
    <operator id="FBDSATreeRootScaler" spec="SAScaleOperator" rootOnly="true" scaleFactor="0.95" tree="@TheTree" weight="1.0"/>
    <operator id="FBDSATreeScaler" spec="SAScaleOperator" scaleFactor="0.95" tree="@TheTree" weight="3.0"/>

    <operator id="BinaryLiabilityScaler" spec="ScaleOperator" parameter="@binaryLiabilities" scaleFactor="0.75" weight="20.0"/>
    <operator id="BinaryLiabilityRandomWalk" spec="RealRandomWalkOperator" parameter="@binaryLiabilities" windowSize="0.5" weight="10.0"/>

    <logger id="tracelog" fileName="LiabilityLikelihood_Gibbs_43.log" logEvery="5000" model="@posterior" sanitiseHeaders="true" sort="smart">
      <log idref="posterior"/>
      <log idref="likelihood"/>
      <log idref="prior"/>
      <log id="TreeStats" spec="beast.evolution.tree.TreeStatLogger" tree="@TheTree"/>
      <log id="SACountFBD" spec="beast.evolution.tree.SampledAncestorLogger" tree="@TheTree"/>
      <log idref="binaryLiabilities"/>
      <log idref="varValues"/>
      <log idref="inverseMatrix"/>
      <log idref="rootValues"/>
      <log idref="FBDdiversificationRate"/>
      <log idref="FBDturnover"/>
      <log idref="FBDsamplingProportion"/>
      <log idref="FBDorigin"/>
    </logger>

    <logger id="screenlog" logEvery="500000">
        <log idref="posterior"/>
        <log id="ESS.0" spec="util.ESS" arg="@posterior"/>
        <log idref="likelihood"/>
        <log idref="prior"/>
    </logger>

    <logger id="treelog" fileName="LiabilityLikelihood_Gibbs_43.trees" logEvery="5000" mode="tree">
        <log id="TreeWithMetaDataLogger" spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@TheTree"/>
    </logger>
  </run>
</beast>
