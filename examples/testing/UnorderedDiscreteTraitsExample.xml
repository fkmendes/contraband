<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.branchratemodel:beast.evolution.likelihood" required="BEAST v2.5.0" version="2.5">

<map name="Uniform" >beast.math.distributions.Uniform</map>
<map name="Exponential" >beast.math.distributions.Exponential</map>
<map name="LogNormal" >beast.math.distributions.LogNormalDistributionModel</map>
<map name="Normal" >beast.math.distributions.Normal</map>
<map name="Beta" >beast.math.distributions.Beta</map>
<map name="Gamma" >beast.math.distributions.Gamma</map>
<map name="LaplaceDistribution" >beast.math.distributions.LaplaceDistribution</map>
<map name="prior" >beast.math.distributions.Prior</map>
<map name="InverseGamma" >beast.math.distributions.InverseGamma</map>
<map name="OneOnX" >beast.math.distributions.OneOnX</map>
<map name="Dirichlet" >beast.math.distributions.Dirichlet</map>

    <data id="discrete_traits" dataType="standard">
        <sequence id="seq_t1" taxon="t1" totalcount="3" value="2001"/>
        <sequence id="seq_t2" taxon="t2" totalcount="3" value="2101"/>
        <sequence id="seq_t7" taxon="t7" totalcount="3" value="2121"/>
        <sequence id="seq_t8" taxon="t8" totalcount="3" value="0001"/>
        <sequence id="seq_t3" taxon="t3" totalcount="3" value="1110"/>
        <sequence id="seq_t4" taxon="t4" totalcount="3" value="0012"/>
        <sequence id="seq_t5" taxon="t5" totalcount="3" value="0011"/>
        <sequence id="seq_t6" taxon="t6" totalcount="3" value="2011"/>
        <sequence id="seq_t15" taxon="t15" totalcount="3" value="2111"/>
        <sequence id="seq_t16" taxon="t16" totalcount="3" value="1101"/>
        <sequence id="seq_t13" taxon="t13" totalcount="3" value="2111"/>
        <sequence id="seq_t11" taxon="t11" totalcount="3" value="0221"/>
        <sequence id="seq_t12" taxon="t12" totalcount="3" value="0221"/>
        <sequence id="seq_t9" taxon="t9" totalcount="3" value="0221"/>
        <sequence id="seq_t10" taxon="t10" totalcount="3" value="2223"/>
        <sequence id="seq_t19" taxon="t19" totalcount="3" value="0013"/>
        <sequence id="seq_t20" taxon="t20" totalcount="3" value="0013"/>
        <sequence id="seq_t14" taxon="t14" totalcount="3" value="2013"/>
        <sequence id="seq_t17" taxon="t17" totalcount="3" value="2213"/>
        <sequence id="seq_t18" taxon="t18" totalcount="3" value="2213"/>
    </data>

<run id="mcmc" spec="MCMC" chainLength="100000000">
	<state id="state" storeEvery="5000">
		<tree id="TheTree" name="stateNode" spec='beast.util.TreeParser'
					newick="(((t1:3.204783812,t2:3.204783812):1.199443095,((t7:1.321123361,t8:1.321123361):1.828368984,(t3:2.756666159,(t4:1.969360899,((t5:1.541006809,t6:1.541006809):0.3636678964,((t15:0.6222802646,t16:0.6222802646):0.2303157481,t13:0.8525960127):1.052078692):0.06468619396):0.78730526):0.3928261865):1.254734562):1.515540644,(((t11:0.8934298139,t12:0.8934298139):0.2914845583,(t9:1.155972574,t10:1.155972574):0.0289417978):2.019120136,((t19:0.1428394258,t20:0.1428394258):2.81794442,(t14:0.8000420536,(t17:0.515191512,t18:0.515191512):0.2848505416):2.160741792):0.2432506626):2.715733044);"
					IsLabelledNewick="true">
	            <taxonset id="TaxonSet" spec="TaxonSet">
                    <taxon id="t1" spec="Taxon"/>
                    <taxon id="t2" spec="Taxon"/>
                    <taxon id="t7" spec="Taxon"/>
                    <taxon id="t8" spec="Taxon"/>
                    <taxon id="t3" spec="Taxon"/>
                    <taxon id="t4" spec="Taxon"/>
                    <taxon id="t5" spec="Taxon"/>
                    <taxon id="t6" spec="Taxon"/>
                    <taxon id="t15" spec="Taxon"/>
                    <taxon id="t16" spec="Taxon"/>
                    <taxon id="t13" spec="Taxon"/>
                    <taxon id="t11" spec="Taxon"/>
                    <taxon id="t12" spec="Taxon"/>
                    <taxon id="t9" spec="Taxon"/>
                    <taxon id="t10" spec="Taxon"/>
                    <taxon id="t19" spec="Taxon"/>
                    <taxon id="t20" spec="Taxon"/>
                    <taxon id="t14" spec="Taxon"/>
                    <taxon id="t17" spec="Taxon"/>
                    <taxon id="t18" spec="Taxon"/>
	            </taxonset>
        </tree>
        <stateNode idref="varValues"/>
		<stateNode idref="rootValues"/>
		<stateNode idref="covValues"/>
        <stateNode idref="BirthRate"/>
        <stateNode idref="unorderedLiabilities"/>
	</state>

	<distribution id="posterior" spec="util.CompoundDistribution">
    <!-- START prior -->
    <distribution id="prior" spec="util.CompoundDistribution">
        <!-- tree prior -->
        <distribution id="YuleModel.prior" spec="beast.evolution.speciation.YuleModel" tree="@TheTree">
            <birthDiffRate id="BirthRate" spec="parameter.RealParameter">0.4</birthDiffRate>
        </distribution>
        <prior id="birthRatePrior" name="distribution" x="@BirthRate">
            <distr id="LogNormal.0" spec="beast.math.distributions.LogNormalDistributionModel" S="0.5" M="1.0" meanInRealSpace="true"/>
        </prior>

        <!-- BM model prior -->
        <distribution id="varValuesPrior" spec="beast.math.distributions.Prior" x="@varValues">
	        <distr id="LogNormal.varValues" spec="beast.math.distributions.LogNormalDistributionModel" S="0.3" M="1.0"/>
        </distribution>
        
        <distribution id="covValuesPrior" spec="beast.math.distributions.Prior" x="@covValues">
	        <distr id="Uniform.correlation" spec="beast.math.distributions.Uniform" lower="-1.0" upper="1.0"/>
        </distribution>

        <distribution id="MeanPrior" spec="beast.math.distributions.Prior" x="@rootValues">
	        <distr id="Normal.Mean" spec="beast.math.distributions.Normal" mean="0.0" sigma="2.0"/>
        </distribution>
    </distribution>
    <!-- END prior -->

    <!-- START likelihood -->
    <distribution id="likelihood" spec="util.CompoundDistribution" useThreads="false">
     <!-- START Morphological likleihood-->
        <distribution id="UnorderedDiscreteLikelihood" spec="contraband.prunelikelihood.UnorderedDiscreteTraits" tree="@TheTree">
            <liability id="unorderedLiabilities" spec="parameter.RealParameter">1.0</liability>
            <data id="unorderedData" spec="FilteredAlignment" data="@discrete_traits" filter="1,2,3,4"/>
        </distribution>

        <distribution id="LiabilityLikelihood" spec="contraband.prunelikelihood.LiabilityLikelihood">
			<tree idref="TheTree"/>

            <unorderedDiscreteTraits idref="UnorderedDiscreteLikelihood"/>
            
			<branchRateModel id="rateCatClock" spec="contraband.clock.RateCategoryClockModel" nCat="1">
                <rates id="rateValues" spec="parameter.RealParameter">1</rates>
                <rateCatAssign id="rateAssignments" spec="parameter.IntegerParameter" lower="0" upper="1">0</rateCatAssign>
                <tree idref="TheTree"/>
            </branchRateModel>

            <nodeMath id="pcmNodeMath" spec="contraband.math.NodeMath" upperMatrix="true">
                <unorderedDiscreteTraits idref="UnorderedDiscreteLikelihood"/>
            	<sigmasq id="varValues" spec="parameter.RealParameter">3.16401657271961 2.7976231505622 2.00009889020044 4.33682198458624 2.61147299926541 4.13427713018147 2.86383474260916 2.20204151464722 2.78606900159375</sigmasq>
                <correlation id="covValues" spec="parameter.RealParameter">0.406894791871309 0.754576489794999 -0.0596277597360313 -0.089467185549438 0.592352417763323 -0.607516988646239 -0.457938978914171 0.576657510362566 0.774505374021828 -0.641429237090051 0.780870479065925 0.356271395459771 -0.543745257426053 -0.687734395731241 0.0940258931368589 -0.700468978844583 0.482228761073202 0.434566108509898 -0.415180548094213 -0.401220715604722 -0.699768688995391 -0.181534413248301 0.762674991041422 -0.322182169184089 0.496656669303775 0.474332851357758 -0.692521954420954 -0.407754351850599 0.223960201721638 -0.479160396847874 -0.716068337671459 0.914515104610473 0.702713758684695 0.806582383811474 0.6118293129839 0.166110266465694</correlation>
                <rootValues id="rootValues" spec="parameter.RealParameter">-1.42305795139175 1.36297503693414 -1.87024501649859 -2.06375076474771 -0.944027097583522 0.501651944903324 -0.96714948194857 -1.10076560702197 -1.96077851076057</rootValues>
            </nodeMath>
        </distribution>
        <!-- END Morphological likleihood -->
	</distribution> 
	<!-- END Likelihood -->
	</distribution> 
	<!-- END Posterior -->
<!--
	<operator id="VarValueScaler" spec="ScaleOperator" parameter="@varValues" scaleFactor="0.75" weight="6.0"/>
    <operator id="CoValueRandomWalk" spec="RealRandomWalkOperator" parameter="@covValues" windowSize="1.0" weight="10.0"/>
    <operator id="MeanRandomWalk" spec="RealRandomWalkOperator" parameter="@rootValues" windowSize="1.0" weight="6.0"/>
-->

    <operator id="YuleTreeScaler" spec="ScaleOperator" scaleFactor="0.5" tree="@TheTree" weight="3.0"/>
    <operator id="YuleTreeRootScaler" spec="ScaleOperator" rootOnly="true" scaleFactor="0.5" tree="@TheTree" weight="3.0"/>
    <operator id="YuleUniformOperator" spec="Uniform" tree="@TheTree" weight="30.0"/>

    <operator id="YuleSubtreeSlide" spec="SubtreeSlide" tree="@TheTree" weight="3.0"/>
    <operator id="YuleNarrows" spec="Exchange" tree="@TheTree" weight="3.0"/>
    <operator id="YuleWide" spec="Exchange" isNarrow="false" tree="@TheTree" weight="3.0"/>
    <operator id="YuleWilsonBalding" spec="WilsonBalding" tree="@TheTree" weight="3.0"/>

    <operator id="BirthRateScaler" spec="ScaleOperator" parameter="@BirthRate" weight="3.0"/>

    <operator id="UnorderedLiabilityRandomWalk" spec="RealRandomWalkOperator" parameter="@unorderedLiabilities" windowSize="1.0" weight="5.0"/>
    <operator id="UnorderedLiabilityScaler" spec="ScaleOperator" parameter="@unorderedLiabilities" weight="5.0"/>

    <logger id="tracelog" fileName="UnorderedDiscreteTraitsExample.log" logEvery="5000" model="@posterior" sanitiseHeaders="true" sort="smart">
      <log idref="posterior"/>
      <log idref="likelihood"/>
      <!--
      <log idref="BinaryDiscreteLikelihood"/>
      -->
      <log idref="prior"/>
      <log id="TreeStats" spec="beast.evolution.tree.TreeStatLogger" tree="@TheTree"/>
      <log idref="BirthRate"/>
      <log idref="unorderedLiabilities"/>

	  <!--
      <log idref="varValues"/>
      <log idref="covValues"/>
      <log idref="rootValues"/>
      -->
    </logger>

    <logger id="screenlog" logEvery="10000">
        <log idref="posterior"/>
        <log id="ESS.0" spec="util.ESS" arg="@posterior"/>
        <log idref="likelihood"/>
        <log idref="prior"/>
    </logger>

    <logger id="treelog" fileName="UnorderedDiscreteTraitsExample.trees" logEvery="5000" mode="tree">
        <log id="TreeWithMetaDataLogger" spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@TheTree"/>
    </logger>
  </run>
</beast>
