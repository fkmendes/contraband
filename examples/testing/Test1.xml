<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.branchratemodel:beast.evolution.likelihood" required="BEAST v2.5.0" version="2.5">

<map name="Uniform" >beast.math.distributions.Uniform</map>
<map name="Exponential" >beast.math.distributions.Exponential</map>
<map name="LogNormal" >beast.math.distributions.LogNormalDistributionModel</map>
<map name="Normal" >beast.math.distributions.Normal</map>
<map name="Beta" >beast.math.distributions.Beta</map>
<map name="Gamma" >beast.math.distributions.Gamma</map>
<map name="LaplaceDistribution" >beast.math.distributions.LaplaceDistribution</map>
<map name="prior" >beast.math.distributions.Prior</map>
<map name="InverseGamma" >beast.math.distributions.InverseGamma</map>
<map name="OneOnX" >beast.math.distributions.OneOnX</map>
<map name="Dirichlet" >beast.math.distributions.Dirichlet</map>

<data id="discrete_traits" dataType="standard">
    <sequence id="seq_t6" taxon="t6" totalcount="3" value="0"/>
    <sequence id="seq_t9" taxon="t9" totalcount="3" value="0"/>
    <sequence id="seq_t10" taxon="t10" totalcount="3" value="0"/>
    <sequence id="seq_t3" taxon="t3" totalcount="3" value="1"/>
    <sequence id="seq_t7" taxon="t7" totalcount="3" value="0"/>
    <sequence id="seq_t8" taxon="t8" totalcount="3" value="0"/>
    <sequence id="seq_t4" taxon="t4" totalcount="3" value="1"/>
    <sequence id="seq_t5" taxon="t5" totalcount="3" value="0"/>
    <sequence id="seq_t2" taxon="t2" totalcount="3" value="1"/>
    <sequence id="seq_t1" taxon="t1" totalcount="3" value="1"/>
</data>



<run id="mcmc" spec="MCMC" chainLength="5000000">
	<state id="state" storeEvery="5000">
        <tree id="TheTree" name="stateNode" spec='beast.util.TreeParser'
              newick="((((t6:1.189026956,(t9:0.1550321765,t10:0.1550321765):1.033994779):1.460090379,(t3:1.967825829,((t7:0.7212948093,t8:0.7212948093):1.006423656,(t4:1.373640911,t5:1.373640911):0.3540775541):0.2401073638):0.6812915054):0.02631446592,t2:2.6754318):1.054321576,t1:3.729753377);"
              IsLabelledNewick="true">
            <taxonset id="TaxonSet" spec="TaxonSet">
                <taxon id="t6" spec="Taxon"/>
                <taxon id="t9" spec="Taxon"/>
                <taxon id="t10" spec="Taxon"/>
                <taxon id="t3" spec="Taxon"/>
                <taxon id="t7" spec="Taxon"/>
                <taxon id="t8" spec="Taxon"/>
                <taxon id="t4" spec="Taxon"/>
                <taxon id="t5" spec="Taxon"/>
                <taxon id="t2" spec="Taxon"/>
                <taxon id="t1" spec="Taxon"/>
            </taxonset>
        </tree>
        <stateNode idref="covValues"/>
        <stateNode idref="binaryLiabilities"/>
        <stateNode idref="contVar"/>
        <stateNode idref="rootValues"/>
	</state>

	<distribution id="posterior" spec="util.CompoundDistribution">
    <!-- START prior -->
    <distribution id="prior" spec="util.CompoundDistribution">
        <distribution id="YuleModelPrior" spec="beast.evolution.speciation.YuleModel" tree="@TheTree">
        <birthDiffRate id="birthRate" spec="parameter.RealParameter">0.4</birthDiffRate>
        </distribution>

        <distribution id="covValuesPrior" spec="beast.math.distributions.Prior" x="@covValues">
            <distr id="Uniform.covValues" spec="beast.math.distributions.Uniform" lower="-0.948683298050514" upper="0.948683298050514"/>
        </distribution>

        <distribution id="rootValuesPrior" spec="beast.math.distributions.Prior" x="@rootValues">
            <distr id="Uniform.root" spec="beast.math.distributions.Normal" mean="0.0" sigma="0.25"/>
        </distribution>

        <distribution id="varValuesPrior" spec="beast.math.distributions.Prior" x="@contVar">
            <distr id="Exponential.varValues" spec="beast.math.distributions.Exponential" mean="1.0"/>
        </distribution>
    </distribution>
    <!-- END prior -->

    <!-- START likelihood -->
    <distribution id="likelihood" spec="util.CompoundDistribution" useThreads="false">
     <!-- START Morphological likleihood-->
        <distribution id="BinaryDiscreteLikelihood" spec="contraband.prunelikelihood.BinaryDiscreteTraits" tree="@TheTree">
            <liability id="binaryLiabilities" spec="parameter.RealParameter">1.0</liability>
            <data id="binaryData" spec="FilteredAlignment" data="@discrete_traits" filter="1"/>
        </distribution>

        <distribution id="PCMLikelihood" spec="contraband.prunelikelihood.BMLikelihood">
            <tree idref="TheTree"/>

            <trait id="morphTraitData" spec="contraband.prunelikelihood.MorphologicalData">
                <tree idref="TheTree"/>
                <traits id="oneTraitData" spec="outercore.parameter.KeyRealParameter" minordimension="1" keys="t6 t9 t10 t3 t7 t8 t4 t5 t2 t1">
                    1.34750075213628 2.07737539586008 1.58356527994101 -2.62053428251143 -0.341806598798494 -0.307021667232928 -2.46099840597897 0.284766480451265 0.238824138803236 -3.79804303649464
                </traits>
                <binaryDiscreteTraits idref="BinaryDiscreteLikelihood"/>
            </trait>

            <branchRateModel id="rateCatClock" spec="contraband.clock.RateCategoryClockModel" nCat="1">
                <rates id="rateValues" spec="parameter.RealParameter">1.0</rates>
                <rateCatAssign id="rateAssignments" spec="parameter.IntegerParameter" lower="0" upper="1">0</rateCatAssign>
                <tree idref="TheTree"/>
            </branchRateModel>

            <nodeMath id="pcmNodeMath" spec="contraband.math.GeneralNodeMath">
                <tree idref="TheTree"/>
                <trait idref="morphTraitData"/>
                <rateMatrix id="traitRateMatrix" spec="contraband.prunelikelihood.SigmaMatrix">
                    <trait idref="morphTraitData"/>
                    <sigmasq id="varValues" spec="beast.core.parameter.CompoundRealParameter">
                        <parameter id="contVar" spec="parameter.RealParameter" dimension="1">1.0</parameter>
                        <parameter id="discVar" spec="parameter.RealParameter" dimension="1">1.0</parameter>
                    </sigmasq>
                    <correlation id="covValues" spec="parameter.RealParameter">0.0</correlation>
                </rateMatrix>
                <rootValues id="rootValues" spec="parameter.RealParameter">0.0</rootValues>
            </nodeMath>
        </distribution>
        <!-- END Morphological likleihood -->
	</distribution> 
	<!-- END Likelihood -->
	</distribution> 
	<!-- END Posterior -->

    <operator id="BinaryLiabilityScaler" spec="ScaleOperator" parameter="@binaryLiabilities" weight="15.0"/>
    <operator id="BinaryLiabilityRandomWalk" spec="RealRandomWalkOperator" parameter="@binaryLiabilities" windowSize="0.75" weight="15.0"/>

    <operator id="covValueScaler" spec="RealRandomWalkOperator" parameter="@covValues" windowSize="0.75" weight="6.0"/>
    <operator id="rootValueScaler" spec="RealRandomWalkOperator" parameter="@rootValues" windowSize="0.75" weight="6.0"/>
    <operator id="VarValueScaler" spec="ScaleOperator" parameter="@contVar" scaleFactor="0.75" weight="6.0"/>
    <operator id="VarValueRandomWalk" spec="RealRandomWalkOperator" parameter="@contVar" windowSize="0.75" weight="6.0"/>

    <!--
    <operator id="VarValueScaler" spec="ScaleOperator" parameter="@varValues" scaleFactor="0.75" weight="6.0"/>
    <operator id="rateValueScaler" spec="ScaleOperator" parameter="@rateValues" scaleFactor="0.75" weight="6.0"/>

    <operator id="YuleTreeScaler" spec="ScaleOperator" scaleFactor="0.5" tree="@TheTree" weight="3.0"/>
    <operator id="YuleTreeRootScaler" spec="ScaleOperator" rootOnly="true" scaleFactor="0.5" tree="@TheTree" weight="3.0"/>
    <operator id="YuleUniformOperator" spec="Uniform" tree="@TheTree" weight="30.0"/>
    <operator id="YuleSubtreeSlide" spec="SubtreeSlide" tree="@TheTree" weight="15.0"/>
    <operator id="YuleTreeNarrow" spec="Exchange" tree="@TheTree" weight="15.0"/>
    <operator id="YuleTreeWide" spec="Exchange" isNarrow="false" tree="@TheTree" weight="3.0"/>
    <operator id="YuleTreeWilsonBalding" spec="WilsonBalding" tree="@TheTree" weight="3.0"/>
    <operator id="BirthRateScaler" spec="ScaleOperator" parameter="@birthRate" scaleFactor="0.75" weight="3.0"/>
-->

    <logger id="tracelog" fileName="Test1.log" logEvery="5000" model="@posterior" sanitiseHeaders="true" sort="smart">
      <log idref="posterior"/>
      <log idref="likelihood"/>
      <log idref="prior"/>
      <log idref="covValues"/>
      <log idref="contVar"/>
      <log idref="discVar"/>
      <log idref="rootValues"/>
      <log idref="binaryLiabilities"/>
    </logger>

    <logger id="screenlog" logEvery="5000">
        <log idref="posterior"/>
        <log id="ESS.0" spec="util.ESS" arg="@posterior"/>
        <log idref="likelihood"/>
        <log idref="prior"/>
    </logger>
<!--
    <logger id="treelog" fileName="Test.trees" logEvery="5000" mode="tree">
        <log id="TreeWithMetaDataLogger" spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@TheTree"/>
    </logger>
-->
  </run>
</beast>
