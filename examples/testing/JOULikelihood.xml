<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.branchratemodel:beast.evolution.likelihood" required="BEAST v2.5.0" version="2.5">

<map name="Uniform" >beast.math.distributions.Uniform</map>
<map name="Exponential" >beast.math.distributions.Exponential</map>
<map name="LogNormal" >beast.math.distributions.LogNormalDistributionModel</map>
<map name="Normal" >beast.math.distributions.Normal</map>
<map name="Beta" >beast.math.distributions.Beta</map>
<map name="Gamma" >beast.math.distributions.Gamma</map>
<map name="LaplaceDistribution" >beast.math.distributions.LaplaceDistribution</map>
<map name="prior" >beast.math.distributions.Prior</map>
<map name="InverseGamma" >beast.math.distributions.InverseGamma</map>
<map name="OneOnX" >beast.math.distributions.OneOnX</map>
<map name="Dirichlet" >beast.math.distributions.Dirichlet</map>


<run id="mcmc" spec="MCMC" chainLength="500000">
	<state id="state" storeEvery="5000">
		<tree id="TheTree" name="stateNode" spec='beast.util.TreeParser' 
					newick="(((t5:1.817200834,((t8:1.198100152,t9:1.198100152):0.09647591001,t7:1.294576062):0.5226247715):2.81691287,t1:0.4510475033):0.8478545584,(((t10:1.050371982,t11:1.050371982):2.196178377,((t4:0.6664595291,((t12:0.7960935013,((t14:0.3280377964,t15:0.3280377964):0.224131159,t13:0.5521689553):0.243924546):0.6327198567,t6:0.9193027238):0.4303386926):0.7483262819,t3:1.389940135):0.6390720264):1.359214975,t2:1.16800625):0.8762029283);" 
					IsLabelledNewick="true">
	            <taxonset id="TaxonSet" spec="TaxonSet">
                <taxon id="t5" spec="Taxon"/>
                  <taxon id="t8" spec="Taxon"/>
                  <taxon id="t9" spec="Taxon"/>
                  <taxon id="t7" spec="Taxon"/>
                  <taxon id="t1" spec="Taxon"/>
                  <taxon id="t10" spec="Taxon"/>
                  <taxon id="t11" spec="Taxon"/>
                  <taxon id="t4" spec="Taxon"/>
                  <taxon id="t12" spec="Taxon"/>
                  <taxon id="t14" spec="Taxon"/>
                  <taxon id="t15" spec="Taxon"/>
                  <taxon id="t13" spec="Taxon"/>
                  <taxon id="t6" spec="Taxon"/>
                  <taxon id="t3" spec="Taxon"/>
                  <taxon id="t2" spec="Taxon"/>
	            </taxonset>

                <trait id="FossilSet" spec="beast.evolution.tree.TraitSet" traitname="date-backward">
					t1=4.1830662007,
                    t4=1.1926925217,
                    t6=0.509510634399999,
                    t3=1.2175381977,
                    t2=3.4377590841
                    <taxa idref="TaxonSet"/>
                </trait>
        </tree>       
        <stateNode idref="sigmasq"/>
        <stateNode idref="rho"/>
        <stateNode idref="popVar"/>
        <stateNode idref="popCov"/>
        <stateNode idref="alpha"/>
        <stateNode idref="theta"/>
        <stateNode idref="jumpVar"/>
        <stateNode idref="jumpCov"/>
        <stateNode idref="jump"/>
        <stateNode idref="jumpIndicators"/>
        <stateNode idref="rootValues"/>
        <stateNode idref="birthRate"/>
        <stateNode idref="deathRate"/>
	</state>

	<distribution id="posterior" spec="util.CompoundDistribution">
    <!-- START prior -->
    <distribution id="prior" spec="util.CompoundDistribution">
        <!-- tree prior -->
        <!-- tree prior -->
        <distribution id="BirthDeathPrior" spec="beast.evolution.speciation.BirthDeathGernhard08Model" tree="@TheTree">
            <birthDiffRate id="birthRate" spec="parameter.RealParameter">1.250255</birthDiffRate>
            <relativeDeathRate id="deathRate" spec="parameter.RealParameter">0.7498399</relativeDeathRate>
        </distribution>
        <distribution id="FBDbirthRatePrior" spec="beast.math.distributions.Prior" x="@birthRate">
            <Uniform id="Uniform.0" name="distr" lower="1.0" upper="1.5"/>
        </distribution>
        <distribution id="FBDdeathRatePrior" spec="beast.math.distributions.Prior" x="@deathRate">
            <Uniform id="Uniform.1" name="distr" lower="0.5" upper="1.0"/>
        </distribution>
        <!-- OU prior -->
        <distribution id="sigmasqPrior" spec="beast.math.distributions.Prior" x="@sigmasq">
            <distr id="LogNormal.sigmasq" spec="beast.math.distributions.LogNormalDistributionModel" S="0.3" M="1.0"/>
        </distribution>
        
        <distribution id="CorrelationPrior" spec="beast.math.distributions.Prior" x="@rho">
            <distr id="Uniform.correlation" spec="beast.math.distributions.Uniform" upper="1.0" lower="-1.0"/>
        </distribution>

        <distribution id="popVarPrior" spec="beast.math.distributions.Prior" x="@popVar">
            <distr id="LogNormal.popVar" spec="beast.math.distributions.LogNormalDistributionModel" S="0.1" M="0.2"/>
        </distribution>

        <distribution id="popCovPrior" spec="beast.math.distributions.Prior" x="@popCov">
            <distr id="Normal.popCov" spec="beast.math.distributions.Normal" mean="0.0" sigma="0.2"/>
        </distribution>

        <distribution id="jumpVarPrior" spec="beast.math.distributions.Prior" x="@jumpVar">
            <distr id="LogNormal.jumpVar" spec="beast.math.distributions.LogNormalDistributionModel" S="0.1" M="0.2"/>
        </distribution>

        <distribution id="jumpCovPrior" spec="beast.math.distributions.Prior" x="@jumpCov">
            <distr id="Normal.jumpCov" spec="beast.math.distributions.Normal" mean="0.0" sigma="0.2"/>
        </distribution>

        <distribution id="jumpPrior" spec="beast.math.distributions.Prior" x="@jump">
            <distr id="Normal.jump" spec="beast.math.distributions.Normal" mean="1.0" sigma="0.3"/>
        </distribution>

        <distribution id="alphaPrior" spec="beast.math.distributions.Prior" x="@alpha">
            <distr id="Normal.alpha" spec="beast.math.distributions.Normal" mean="1.0" sigma="0.3"/>
        </distribution>

        <distribution id="thetaPrior" spec="beast.math.distributions.Prior" x="@theta">
            <distr id="Normal.theta" spec="beast.math.distributions.Normal" mean="1.0" sigma="0.3"/>
        </distribution>

        <distribution id="rootValuesPrior" spec="beast.math.distributions.Prior" x="@rootValues">
            <distr id="Normal.root" spec="beast.math.distributions.Normal" mean="0.0" sigma="1.0"/>
        </distribution>

        <distribution id="jumpIndicatorPrior" spec="beast.math.distributions.Prior" x="@jumpIndicators">
            <distr id="Unif.jumpIndicator" spec="beast.math.distributions.Uniform" offset="0.0" lower="0.0" upper="1.0"/>
        </distribution>

    </distribution>
    <!-- END prior -->

    <!-- START likelihood -->
    <distribution id="likelihood" spec="util.CompoundDistribution" useThreads="false">
     <!-- START Morphological likleihood-->
        <distribution id="PCMLikelihood" spec="contraband.prunelikelihood.OULikelihood">
            <tree idref="TheTree"/>

            <trait id="morphTraitData" spec="contraband.prunelikelihood.MorphologicalData">
                <tree idref="TheTree"/>
                <traits id="oneTraitData" spec="outercore.parameter.KeyRealParameter" minordimension="2" keys="t5 t8 t9 t7 t1 t10 t11 t4 t12 t14 t15 t13 t6 t3 t2">
                    -0.742047009942882 1.32622692122696 0.17421479040176 2.12416317255726 3.12046434234817 0.484493990377829 2.78669474158155 0.659591379611042 -0.685227897451375 -0.520829482173373 2.30732517269681 -0.0632392675522868 3.0180094527939 -0.350045619103057 -0.0617091935358255 -1.54285220494148 -0.889336752176648 0.984753221390041 0.979709157789606 2.57269539073287 -0.388705198088965 0.615111218036593 1.45023317109808 0.749629683574989 -0.0479558208025148 1.92481909314075 -0.842403503272288 -0.729306085242925 0.418558929766809 0.397402940792757
                </traits>
            </trait>

            <branchRateModel id="rateCatClock" spec="contraband.clock.RateCategoryClockModel" nCat="1">
                <rates id="rateValues" spec="parameter.RealParameter">1</rates>
                <rateCatAssign id="rateAssignments" spec="parameter.IntegerParameter" lower="0" upper="1">0</rateCatAssign>
                <tree idref="TheTree"/>
            </branchRateModel>

            <nodeMath id="pcmNodeMath" spec="contraband.math.GeneralNodeMath" shareCorrelation="true">
                <tree idref="TheTree"/>
                <trait idref="morphTraitData"/>
                <rateMatrix id="traitRateMatrix" spec="contraband.prunelikelihood.SigmaMatrix" upperMatrix="true">
                    <trait idref="morphTraitData"/>
                    <sigmasq id="sigmasq" spec="parameter.RealParameter">1.0</sigmasq>
                    <correlation id="rho" spec="parameter.RealParameter">0.0</correlation>
                </rateMatrix>
                <popMatrix id="popVariance" spec="contraband.prunelikelihood.SigmaMatrix" upperMatrix="true">
                    <trait idref="morphTraitData"/>
                    <sigmasq id="popVar" spec="parameter.RealParameter">1.0</sigmasq>
                    <covariance id="popCov" spec="parameter.RealParameter">0.0</covariance>
                </popMatrix>
                <rootValues id="rootValues" spec="parameter.RealParameter">0.0</rootValues>
            </nodeMath>
            <params id="ouModel" spec="contraband.prunelikelihood.OUModelParameter" optNr="1">
                <trait idref="morphTraitData"/>
                <alpha id="alpha" spec="parameter.RealParameter">1.0</alpha>
                <theta id="theta" spec="parameter.RealParameter">1.0</theta>
                <jumpMean id="jump" spec="parameter.RealParameter">1.0</jumpMean>
                <jumpVCVMat id="jumpVCVMat" spec="contraband.prunelikelihood.SigmaMatrix" upperMatrix="true">
                    <trait idref="morphTraitData"/>
                    <sigmasq id="jumpVar" spec="parameter.RealParameter">1.0</sigmasq>
                    <covariance id="jumpCov" spec="parameter.RealParameter">0.0</covariance>
                </jumpVCVMat>
                <optAssign id="optAssignment" spec="parameter.IntegerParameter">0</optAssign>
                <jumpIndicator id="jumpIndicators" spec="parameter.IntegerParameter">0</jumpIndicator>
            </params>
        </distribution>
        <!-- END Morphological likleihood -->
	</distribution> 
	<!-- END Likelihood -->
	</distribution> 
	<!-- END Posterior -->

    <!-- OU parameters -->
    <operator id="SigmasqScaler" spec="ScaleOperator" parameter="@sigmasq" scaleFactor="0.75" weight="6.0"/>
    <operator id="CorrelationScaler" spec="RealRandomWalkOperator" parameter="@rho" windowSize="0.75" weight="6.0"/>
    <operator id="popVarScaler" spec="ScaleOperator" parameter="@popVar" scaleFactor="0.75" weight="6.0"/>
    <operator id="popCovScaler" spec="RealRandomWalkOperator" parameter="@popCov" windowSize="0.75" weight="6.0"/>
    <operator id="AlphaScaler" spec="RealRandomWalkOperator" parameter="@alpha" windowSize="0.75" weight="6.0"/>
    <operator id="ThetaScaler" spec="RealRandomWalkOperator" parameter="@theta" windowSize="0.75" weight="6.0"/>
    <operator id="rootValueScaler" spec="RealRandomWalkOperator" parameter="@rootValues" windowSize="0.75" weight="6.0"/>
    <operator id="jumpVarScaler" spec="ScaleOperator" parameter="@jumpVar" scaleFactor="0.75" weight="6.0"/>
    <operator id="jumpCovScaler" spec="RealRandomWalkOperator" parameter="@jumpCov" windowSize="0.75" weight="6.0"/>
    <operator id="JumpScaler" spec="RealRandomWalkOperator" parameter="@jump" windowSize="0.75" weight="6.0"/>
    <operator id="jumpIndicatorRandomWalk" spec="IntRandomWalkOperator" parameter="@jumpIndicators" windowSize="1" weight="6.0"/>

    <!-- tree operators -->
    <operator id="UniformOperator" spec="Uniform" tree="@TheTree" weight="20.0"/>
    <operator id="TreeRootScaler" spec="ScaleOperator" rootOnly="true" scaleFactor="0.95" tree="@TheTree" weight="1.0"/>
    <operator id="TreeScaler" spec="ScaleOperator" scaleFactor="0.95" tree="@TheTree" weight="3.0"/>
    <operator id="BirthDeathSubtreeSlide" spec="SubtreeSlide" tree="@TheTree" weight="15.0"/>
    <operator id="BirthDeathNarrow" spec="Exchange" tree="@TheTree" weight="15.0"/>
    <operator id="BirthDeathWide" spec="Exchange" isNarrow="false" tree="@TheTree" weight="3.0"/>
    <operator id="BirthDeathWilsonBalding" spec="WilsonBalding" tree="@TheTree" weight="3.0"/>
    <operator id="BirthRateScaler" spec="ScaleOperator" parameter="@birthRate" scaleFactor="0.75" weight="3.0"/>
    <operator id="DeathRateScaler" spec="ScaleOperator" parameter="@deathRate" scaleFactor="0.75" weight="3.0"/>

    <logger id="tracelog" fileName="JOULikelihood.log" logEvery="5000" model="@posterior" sanitiseHeaders="true" sort="smart">
      <log idref="posterior"/>
      <log idref="likelihood"/>
      <log idref="prior"/>
      <log id="TreeStats" spec="beast.evolution.tree.TreeStatLogger" tree="@TheTree"/>
      <log idref="sigmasq"/>
      <log idref="rho"/>
      <log idref="popVar"/>
      <log idref="popCov"/>
      <log idref="theta"/>
      <log idref="alpha"/>
      <log idref="rootValues"/>
    </logger>

    <logger id="screenlog" logEvery="5000">
        <log idref="posterior"/>
        <log id="ESS.0" spec="util.ESS" arg="@posterior"/>
        <log idref="likelihood"/>
        <log idref="prior"/>
    </logger>
    <!--
    <logger id="treelog" fileName="OULikelihood.trees" logEvery="5000" mode="tree">
        <log id="TreeWithMetaDataLogger" spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@TheTree"/>
    </logger>
    -->
  </run>
</beast>
