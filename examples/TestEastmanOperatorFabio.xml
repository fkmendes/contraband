<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="FullMorphModels.prunelikelihood:FullMorphModels.coloroperator:beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood" required="BEAST v2.5.0" version="2.5">

  <run id="mcmc" spec="MCMC" chainLength="10000" sampleFromPrior="true">

    <state id="state" storeEvery="1">
      <stateNode id="nColors" spec="parameter.IntegerParameter" value="7"/>

      <stateNode id="colorValues" spec="parameter.RealParameter" value="0.1 0.1 0.1 0.1 0.1 0.1 0.1" lower="0"/>
      <stateNode id="colorAssignments" spec="parameter.IntegerParameter" value="0 0 0 0 0 0 0"/>

        <!--
      <stateNode id="colorValues" spec="parameter.RealParameter" value="0.2 0.4 0.6 0.8 1.2 0.1 0.2 0.3 0.4 0.1 0.1" lower="0"/>
      <stateNode id="colorAssignments" spec="parameter.IntegerParameter" value="0 0 0 0 0 0 0 0 0 0 0"/>
       -->
      <stateNode idref="FixedTree"/>
    </state>

    <distribution id="posterior" spec="util.CompoundDistribution">

      <!-- START prior -->
      <distribution id="prior" spec="util.CompoundDistribution">

	  <distribution id="nColorPrior" spec="beast.math.distributions.Prior" x="@nColors">
	  <!--<distr id="Exp.nColors" spec="beast.math.distributions.Exponential" offset="0.0" mean="5"/>-->
      <distr id="Uniform.nColors" spec="beast.math.distributions.Uniform" lower="1" upper="7" />
<!--        <distr id="Poisson.nColors" spec="beast.math.distributions.Poisson" lambda="0.1" /> -->
	  </distribution>

<!--       <distribution id="colorAssignmentsPrior" spec="beast.math.distributions.Prior" x="@colorAssignments"> -->
<!--               <distr id="Exp.nColors" spec="beast.math.distributions.Exponential" offset="0.0" mean="5"/> -->
<!--       <distr id="Uniform.colorAssignments" spec="beast.math.distributions.Uniform"  lower="0" upper="6" /> -->
<!--       </distribution> -->
<!--
      <distribution id="colorValuePrior" spec="beast.math.distributions.Prior" x="@colorValues">
      <distr id="Uniform.colorValues" spec="beast.math.distributions.Uniform"  lower="0" upper="10" />
      <distr id="LogNormal.colorValues" spec="beast.math.distributions.LogNormalDistributionModel" S="0.2"  M="0.5" meanInRealSpace="true"/>
      </distribution>
-->
      </distribution>
      <!-- END prior -->

      <distribution id="likelihood" spec="util.CompoundDistribution" useThreads="false">

	    <distribution id="BMMVNShift" spec="contraband.BMMVNShiftLikelihoodOneTrait" mean="0.0">

	      <tree id="FixedTree" spec="beast.util.TreeParser" IsLabelledNewick="true" adjustTipHeights="false" newick="(((sp1:1.0,sp2:1.0):1.0,sp3:1.0):1.0,sp4:1.0);" offset="0" singlechild="false">

        <!--
          <tree id="FixedTree" spec="beast.util.TreeParser" IsLabelledNewick="true" adjustTipHeights="false" newick="(((sp1:1.0,sp2:1.0):1.0,sp3:2.0):2.0,(sp4:2.5,sp5:2.5):1.5);" offset="0" singlechild="false">
          -->
            <!--
          <tree id="FixedTree" spec="beast.util.TreeParser" IsLabelledNewick="true" adjustTipHeights="false" newick="(((sp1:1.0,sp2:1.0):3.0,(sp3:2.0,sp4:2.0)):1.0,(sp5:2.5,sp6:2.5):2.5);" offset="0" singlechild="false">
-->
            <taxonset id="TaxonSet" spec="TaxonSet">
	          <taxon id="sp1" spec="Taxon"/>
	          <taxon id="sp2" spec="Taxon"/>
	          <taxon id="sp3" spec="Taxon"/>
	          <taxon id="sp4" spec="Taxon"/>
<!--
                <taxon id="sp4" spec="Taxon"/>
                <taxon id="sp5" spec="Taxon"/>
                <taxon id="sp6" spec="Taxon"/>
-->
	        </taxonset>
	      </tree>

          <oneTraitData id="oneTraitData" spec="contraband.OneValueContTraits" spNames="sp1,sp2,sp3,sp4" nTraits="1">
                <traitValues id="fixedTraitValues" spec="parameter.RealParameter">4.1 3.8 4.8 5.1</traitValues>
          </oneTraitData>

          <rateManager id="rateManager" spec="contraband.ColorManager" nTraits="1" nColors="7" coalCorrection="false">
           <tree idref="FixedTree"/>
           <colorValues idref="colorValues"/>
           <colorAssignments idref="colorAssignments"/>
          </rateManager>

	    </distribution> <!-- END BM -->

      </distribution> <!-- END prunelikelihood -->

    </distribution> <!-- END Posterior -->

    <operator id="EastmanOperatorFabio" spec="contraband.EastmanOperatorFabio" nColor="@nColors" tree="@FixedTree"
              colorAssignments="@colorAssignments" weight="3.0"/>

    <!-- <operator id="uniform" spec="beast.evolution.operators.IntRandomWalkOperator" parameter="@nColors" windowSize="1" weight="3.0"/>-->

    <logger id="tracelog" fileName="testEastmanoperator.log" logEvery="1" model="@posterior" sanitiseHeaders="true" sort="smart">
      <log idref="posterior"/>
      <log idref="likelihood"/>
      <log idref="prior"/>
        <!--
      <log idref="colorValues"/>
      -->
      <log idref="colorAssignments"/>
      <log idref="nColors"/>
    </logger>

    <logger id="screenlog" logEvery="1">
        <log idref="posterior"/>
        <log id="ESS.0" spec="util.ESS" arg="@posterior"/>
        <log idref="likelihood"/>
        <log idref="prior"/>
        <log idref="nColors"/>
    </logger>

    <logger id="treelog.t:firsthalf" fileName="testEastmanoperator.trees" logEvery="5000000" mode="tree">
        <log id="TreeWithMetaDataLogger" spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@FixedTree"/>
    </logger>
  </run>
</beast>
