<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood:beast.evolution.speciation" required="BEAST v2.5.0" version="2.5">

  <run id="mcmc" spec="MCMC" chainLength="5000000">
    <state id="state" storeEvery="5000">
      <stateNode idref="rateValues"/>
      <stateNode idref="shiftIndicators"/>
    </state>
	    
    <distribution id="posterior" spec="util.CompoundDistribution">
      <!-- START prior -->
    <distribution id="prior" spec="util.CompoundDistribution">
	
	<distribution id="rateValuesPrior" spec="beast.math.distributions.Prior" x="@rateValues">
	 <distr id="LogNormal.rateValues" spec="beast.math.distributions.LogNormalDistributionModel" M="[LogMeanHere]" S="[LogSdHere]" meanInRealSpace="false"/>
	</distribution>

    <distribution id="shiftIndicatorPrior" spec="beast.math.distributions.Prior">
      <x spec="beast.core.util.Sum" id="indicatorSum" arg="@shiftIndicators" tree="@TheTree" ignoreZeroBranchLengths="true"/>
      <distr id="Pois.indicator" spec="beast.math.distributions.Poisson" lambda="[LambdaHere]"/>
    </distribution>

    </distribution>
      <!-- END prior -->

      <distribution id="likelihood" spec="util.CompoundDistribution" useThreads="false">
		<distribution id="BMMVNShift" spec="contraband.BMMVNShiftLikelihoodOneTrait">

          <tree id="TheTree" spec="beast.util.TreeParser" IsLabelledNewick="true" adjustTipHeights="false"
                newick="[TreeHere]"
                offset="0" singlechild="false">

              <taxonset id="TaxonSet" spec="TaxonSet">
                [TaxonSetHere]
              </taxonset>
	  	  </tree>

          <oneTraitData id="oneTraitData" spec="contraband.OneValueContTraits" nTraits="1" spNames="[SpNamesHere]">
            <traitValues id="fixedTraitValues" spec="parameter.RealParameter">[TraitValuesHere]</traitValues>
          </oneTraitData>

      	  <rateManager id="rateManager" spec="contraband.TreeToVCVMat" coalCorrection="false">
		    <branchRateModel id="rateRandomLocalClock" spec="contraband.RandomLocalColorModel" scaling="false" includeRoot="true">
                <indicators id="shiftIndicators" spec="parameter.BooleanParameter"  value="false"/>
                <colors id="rateValues" spec="parameter.RealParameter"  value="0.1"/>
                <tree idref="TheTree"/>
	        </branchRateModel>
	    
		    <tree idref="TheTree"/>
	  	  </rateManager>
	    
	  	  <rootValue id="BMMean" dimension="1" spec="parameter.RealParameter">0.0</rootValue>
	    </distribution> <!-- END BMVN -->
      </distribution> <!-- END Likelihood -->
    </distribution> <!-- END Posterior -->

    <operator id="ShiftIndicatorOperator" spec="BitFlipOperator" parameter="@shiftIndicators" uniform="true" weight="10.0"/>
    <operator id="RateValueWalker" spec="contraband.operators.RandomLocalTraitOperator" shiftIndicators="@shiftIndicators" traits="@rateValues" windowSize="1.0" weight="20.0" p="0.5">
      <randomColorModel idref="rateRandomLocalClock"/>
    </operator>

    <logger id="tracelog" fileName="[Filename].log" logEvery="2000" model="@posterior" sanitiseHeaders="true" sort="smart">
      <log idref="posterior"/>
      <log idref="likelihood"/>
      <log idref="prior"/>
      <log idref="BMMean"/>
      <log id="indicatorSimpleSum" spec="beast.core.util.Sum" arg="@shiftIndicators"/>
      <log idref="indicatorSum"/>
      <log idref="rateValues"/>
    </logger>

    <logger id="screenlog" logEvery="10000">
        <log idref="posterior"/>
        <log id="ESS.0" spec="util.ESS" arg="@posterior"/>
        <log idref="likelihood"/>
        <log idref="prior"/>
    </logger>

    <logger id="treelog" fileName="[Filename].trees" logEvery="2000" mode="tree">
        <log id="TreeWithMetaDataLogger" spec="contraband.RateAndShiftLogger" metadata="@shiftIndicators" branchratemodel="@rateRandomLocalClock" tree="@TheTree"/>
    </logger>
  </run>
</beast>
