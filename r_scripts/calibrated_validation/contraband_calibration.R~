library(mvMORPH)
library(TreeSim)
library(ape)
set.seed(123)

n.sim <- 100
n.spp <- 50

## in ape, branch numbering is done in postorder order: to see the order of branches, you can do tr <- reorder(tr, "po"); plor(tr); edgelabels()

## simulating birth-death tree
lambda <- rexp(1, rate=80) # lambda from exponential (mean = 1/80)
mu <- rexp(1, rate=100) # mu from exponential (mean = 1/100)
tr <- sim.bd.taxa.age(n.spp, 1, lambda, mu, age=100, mrca=TRUE)[[1]]; write.tree(tr) # mrca=TRUE means the process starts at the root (i.e., no root edge)

## simulating quant trait data sets
sigmas <- rlnorm(n.sim, meanlog=0, sdlog=1); sigma # 1.201629
x0s <- rnorm(n.sim, mean=0, sd=1)
datasets <- vector("list", n.sim) # storing sims

## actually simulating
for (i in 1:n.sim) {
    datasets[[i]] = rTraitCont(tr, model="BM", sigma=sigmas[i], theta=x0s[i])
}

## MLE
## res <- mvBM(tr, dataset, model="BM1")
## res$theta
## res$sigma
